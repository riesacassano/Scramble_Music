library(caret) # version 6.0-94
library(tidyverse) # version 2.0.0
library(reshape2) # version 1.4.4

# data are hard-coded from '../data/primary/dataConfuseMatrix.xlsx'

#Nonmusicians
expected_value_nonMus <- factor(c(1, 4, 3,	3,	4,	1,	2,	2,	4,	4,	3,	3,	1,	1,	2,	2,	2,	1,	4,	3,	3,	4,	1,	2,	3,	2,	3,	1,	1,	4,	4,	2,	1,	3,	1,	3,	4,	3,	3,	2,	4,	3,	1,	1,	4,	1,	4,	3,	3,	2,	2,	4,	3,	3,	2,	4,	1,	1,	4,	3,	4,	2,	2,	3,	1,	1,	3,	4,	4,	1,	1,	3,	2,	2,	3,	1,	3,	4,	2,	4,	1,	1,	4,	1,	4,	2,	2,	3,	3,	1,	2,	3,	1,	4,	2,	3,	4,	3,	4,	1,	4,	3,	2,	2,	1,	3,	4,	2,	4,	1,	3,	2,	1,	1,	4,	4,	2,	3,	1,	2,	3,	2,	4,	3,	4,	1,	4,	1,	3,	2,	3,	4,	2,	4,	4,	1,	2,	2,	1,	3,	3,	4,	1,	4,	1,	3,	3,	2,	2,	4,	1,	1,	4,	2,	2,	3,	3,	4,	3,	4,	3,	1,	1,	2,	2,	3,	4,	4,	2,	1,	3,	1,	2,	4,	1,	3,	1,	3,	2,	2,	4,	4,	1,	4,	1,	3,	2,	2,	2,	4,	1,	1,	2,	4,	3,	3,	3,	1,	4,	3,	2,	2,	1,	1,	1,	2,	4,	2,	4,	3,	3,	4,	3,	3,	1,	4,	1,	2,	2,	3,	3,	2,	1,	4,	1,	4,	2,	3,	1,	4,	4,	2,	3,	2,	1,	4,	2,	3,	1,	3,	2,	4,	1,	1,	2,	4,	3,	2,	1,	1,	2,	1,	2,	3,	4,	4,	3,	2,	1,	4,	1,	4,	3,	3,	4,	1,	3,	2,	3,	4,	2,	3,	4,	3,	4,	2,	2,	1,	1,	1,	3,	4,	1,	2,	2,	3,	4,	3,	4,	2,	4,	1,	1,	1,	2,	2,	1,	4,	3,	4,	3,	4,	3,	4,	1,	2,	1,	2,	3,	2,	3,	3,	1,	4,	1,	4,	2,	4,	4,	2,	1,	3,	1,	3,	2,	3,	2,	1,	4,	1,	3,	4,	1,	2,	1,	3,	4,	3,	4,	2,	4,	3,	3,	1,	1,	2,	2,	4,	2,	2,	1,	1,	4,	4,	3,	2,	4,	4,	1,	2,	1,	3,	3,	1,	1,	2,	4,	3,	2,	3,	4,	4,	4,	2,	1,	2,	3,	3,	1,	1,	2,	2,	1,	3,	3,	4,	4,	4,	1,	4,	1,	3,	3,	2,	2,	2,	3,	4,	4,	3,	1,	3,	4,	2,	3,	1,	2 ,1))
predicted_value_nonMus <- factor(c(2,	1,	2,	3,	4,	3,	3,	3,	3,	1,	2,	3,	3,	2,	3,	2,	2,	3,	1,	3,	3,	4,	2,	4,	3,	2,	3,	1,	1,	3,	4,	4,	4,	1,	2,	3,	1,	3,	2,	3,	3,	2,	2,	2,	1,	2,	1,	2,	3,	2,	2,	2,	1,	2,	2,	2,	3,	4,	3,	2,	2,	3,	1,	2,	3,	1,	2,	3,	2,	3,	3,	2,	1,	2,	3,	2,	3,	4,	2,	4,	1,	1,	1,	2,	3,	2,	1,	1,	1,	2,	1,	1,	2,	1,	3,	3,	2,	1,	3,	1,	2,	4,	1,	2,	2,	3,	3,	3,	1,	2,	4,	4,	3,	3,	2,	3,	1,	4,	3,	4,	4,	3,	4,	3,	2,	2,	2,	3,	3,	2,	3,	3,	4,	4,	3,	3,	3,	2,	1,	3,	3,	1,	3,	2,	3,	2,	1,	4,	2,	2,	3,	1,	2,	3,	3,	2,	2,	4,	3,	2,	2,	2,	2,	2,	1,	2,	4,	3,	1,	2,	3,	1,	2,	3,	2,	2,	1,	1,	1,	2,	4,	4,	2,	4,	2,	3,	4,	2,	2,	2,	4,	4,	4,	4,	4,	2,	3,	4,	3,	4,	3,	3,	1,	2,	1,	2,	1,	2,	3,	3,	3,	2,	2,	3,	2,	3,	1,	3,	2,	2,	3,	2,	4,	2,	3,	3,	2,	4,	3,	4,	3,	2,	2,	2,	2,	3,	2,	3,	2,	2,	1,	2,	1,	4,	3,	2,	4,	4,	4,	2,	2,	3,	1,	3,	2,	2,	1,	3,	2,	2,	2,	3,	1,	3,	2,	3,	3,	2,	3,	3,	4,	3,	1,	2,	4,	1,	2,	1,	1,	3,	3,	2,	3,	2,	1,	1,	2,	3,	3,	2,	3,	3,	2,	1,	3,	2,	1,	4,	3,	4,	4,	2,	2,	2,	4,	3,	2,	4,	4,	3,	4,	4,	4,	3,	2,	3,	2,	2,	1,	2,	1,	3,	2,	4,	2,	3,	4,	4,	2,	2,	2,	4,	2,	3,	1,	2,	3,	3,	3,	3,	4,	3,	3,	1,	2,	2,	3,	4,	1,	3,	2,	1,	3,	2,	1,	2,	4,	4,	1,	1,	2,	3,	3,	2,	2,	1,	3,	3,	2,	1,	1,	2,	2,	3,	1,	3,	3,	3,	3,	2,	3,	2,	4,	4,	2,	4,	4,	4,	1,	4,	2,	3,	4,	1,	1,	3,	2,	4,	4,	3,	3,	3,	2,	1,	2,	4,	2,	1))

#Creating confusion matrix
confusionSeg_nonMus <- confusionMatrix(data=predicted_value_nonMus, reference = expected_value_nonMus)

#Display results 
confusionSeg_nonMus

matrix_nonMus <- confusionSeg_nonMus$table

#Musicians
expected_value_mus <- factor(c(2,	1,	1,	3,	3,	4,	4,	4,	3,	2,	4,	1,	2,	1,	3,	3,	1,	2,	4,	1,	4,	3,	2,	1,	4,	2,	4,	1,	3,	2,	3,	3,	2,	1,	2,	3,	4,	1,	4,	3,	1,	1,	2,	4,	2,	4,	3,	3,	2,	2,	4,	1,	3,	1,	4,	4,	4,	3,	2,	1,	2,	1,	2,	2,	3,	3,	1,	1,	4,	4,	4,	3,	4,	2,	1,	2,	3,	1,	2,	1,	2,	3,	1,	4,	4,	3,	4,	1,	4,	3,	3,	1,	2,	2,	2,	1,	3,	1,	4,	4,	3,	2,	3,	1,	1,	2,	3,	2,	4,	4,	3,	1,	4,	1,	2,	2,	3,	1,	4,	2,	1,	3,	4,	3,	2,	4,	3,	4,	3,	2,	1,	1,	2,	1,	2,	2,	1,	4,	4,	3,	3,	1,	4,	4,	1,	2,	2,	3,	3,	3,	1,	1,	3,	4,	2,	4,	2,	4,	3,	1,	3,	4,	1,	2,	4,	1,	2,	1,	4,	2,	3,	3,	1,	2,	4,	3,	2,	3,	1,	2,	2,	3,	4,	1,	4,	1,	3,	2,	3,	4,	1,	1,	2,	4,	2,	3,	1,	2,	4,	3,	1,	4,	3,	3,	1,	2,	1,	4,	4,	2,	4,	1,	3,	3,	2,	2,	4,	1,	3,	4,	4,	2,	2,	1,	1,	3,	2,	3,	4,	1,	4,	2,	3,	1,	1,	4,	1,	2,	3,	4,	2,	1,	4,	2,	3,	3,	1,	4,	4,	1,	1,	4,	3,	2,	2,	3,	2,	2,	3,	1,	4,	4,	1,	4,	1,	4,	2,	2,	1,	3,	3,	2,	2,	4,	1,	3,	3,	1,	4,	3,	1,	4,	2,	1,	3,	2,	4,	4,	3,	1,	3,	4,	1,	2,	2,	3,	1,	4,	3,	2,	2,	4,	1,	1,	4,	3,	2,	3,	1,	2,	4,	4,	4,	1,	3,	1,	3,	2,	2,	1,	4,	3,	2,	1,	3,	4,	2,	1,	4,	4,	2,	1,	3,	2,	3,	1,	1,	4,	3,	4,	2,	2,	3,	4,	4,	1,	3,	2,	2,	1,	3,	2,	3,	2,	1,	4,	4,	1,	3,	4,	2,	3,	1,	4,	3,	1,	2,	2,	4,	2,	1,	3,	1,	4,	3,	1,	3,	4,	1,	2,	4,	3,	2,	2,	1,	2,	1,	3,	4,	3,	4,	1,	3,	2,	1,	3,	4,	2,	4,	3,	3,	4,	4,	2,	1,	1,	2,	3,	2,	2,	3,	4,	1,	1,	4,	1,	2,	3,	1,	3,	4,	2,	4))
predicted_value_mus <- factor(c(3,	4,	3,	4,	2,	1,	3,	2,	3,	2,	2,	2,	3,	2,	2,	2,	2,	3,	3,	2,	3,	3,	3,	3,	4,	2,	3,	1,	4,	1,	3,	2,	2,	3,	2,	2,	2,	3,	2,	3,	2,	4,	2,	4,	2,	4,	3,	3,	2,	3,	4,	1,	3,	2,	4,	3,	4,	3,	2,	1,	2,	1,	3,	2,	3,	3,	1,	1,	4,	4,	3,	3,	4,	2,	1,	2,	2,	2,	2,	2,	2,	3,	2,	4,	1,	3,	2,	4,	3,	2,	2,	4,	3,	3,	3,	1,	3,	2,	3,	3,	3,	2,	2,	1,	3,	1,	2,	1,	3,	1,	3,	1,	3,	1,	2,	1,	2,	3,	4,	2,	1,	3,	4,	4,	2,	1,	2,	2,	2,	2,	1,	1,	2,	2,	2,	2,	2,	2,	1,	1,	1,	4,	2,	3,	4,	3,	2,	4,	2,	3,	3,	2,	4,	4,	1,	4,	2,	4,	3,	2,	3,	4,	1,	2,	3,	2,	1,	3,	1,	3,	2,	3,	3,	2,	2,	3,	3,	2,	2,	4,	3,	1,	2,	3,	3,	3,	3,	2,	3,	4,	2,	2,	1,	4,	2,	3,	1,	2,	3,	4,	2,	4,	2,	3,	1,	2,	2,	1,	4,	4,	4,	2,	3,	3,	2,	2,	4,	1,	3,	4,	3,	2,	3,	2,	1,	3,	2,	4,	4,	2,	4,	2,	3,	1,	2,	4,	3,	2,	3,	4,	3,	1,	4,	2,	4,	3,	1,	4,	3,	1,	1,	3,	3,	2,	2,	3,	2,	4,	4,	1,	4,	4,	2,	4,	2,	4,	2,	2,	1,	4,	3,	2,	1,	2,	1,	1,	2,	2,	1,	1,	2,	1,	2,	2,	3,	2,	4,	2,	3,	2,	3,	3,	1,	2,	2,	4,	2,	3,	3,	2,	2,	4,	1,	3,	3,	2,	2,	2,	3,	2,	4,	4,	4,	2,	3,	1,	4,	2,	2,	1,	2,	3,	2,	1,	3,	4,	1,	2,	4,	3,	1,	1,	3,	2,	3,	4,	2,	4,	4,	4,	3,	2,	3,	3,	3,	1,	3,	2,	2,	1,	3,	2,	3,	4,	2,	2,	4,	3,	3,	1,	3,	4,	1,	2,	3,	1,	1,	2,	1,	2,	4,	2,	2,	1,	4,	2,	1,	3,	2,	3,	1,	2,	2,	2,	3,	2,	1,	2,	3,	2,	3,	1,	3,	3,	2,	2,	2,	1,	1,	1,	2,	1,	2,	4,	3,	1,	1,	2,	2,	1,	3,	2,	1,	1,	2,	2,	2,	3,	1,	3,	1,	2,	3))

#Creating confusion matrix
confusionSeg_mus <- confusionMatrix(data=predicted_value_mus, reference = expected_value_mus)

#Display results 
confusionSeg_mus

matrix_mus <- confusionSeg_mus$table

max_value <- max(matrix_nonMus, matrix_mus)

#Heatmap

x_labels <- c("1B", "2B", "8B", "Intact")
y_labels <- c("1B", "2B", "8B", "Intact")

#nonmusicians
heatmap_df <- melt(matrix_nonMus)

num_cols <- ncol(heatmap_df)
num_rows <- nrow(heatmap_df)

ggplot(heatmap_df, aes(x = Prediction, y = Reference, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "purple", limits = c(0, max_value), name = "Count") +
  labs(title = "Confusion Matrix - Non-musicians", x = "Participant Response", y = "True Category") +
  scale_x_continuous(breaks = seq_along(x_labels), labels = x_labels) +
  scale_y_continuous(breaks = seq_along(y_labels), labels = y_labels) 
ggsave('../figures/Fig6A_confusion_matrix_nonmusicians.png', width = 5, height = 4.5)

#musicians
heatmap_df_mus <- melt(matrix_mus)

ggplot(heatmap_df_mus, aes(x = Prediction, y = Reference, fill = value)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "purple", limits = c(0, max_value), name = "Count") +
  labs(title = "Confusion Matrix - Musicians", x = "Participant Response", y = "True Category") +
  scale_x_continuous(breaks = seq_along(x_labels), labels = x_labels) +
  scale_y_continuous(breaks = seq_along(y_labels), labels = y_labels)
ggsave('../figures/Fig6B_confusion_matrix_musicians.png', width = 5, height = 4.5)